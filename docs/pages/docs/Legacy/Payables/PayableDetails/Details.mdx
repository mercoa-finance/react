import {
  InvoiceComments,
  MercoaSession,
  PayableActions,
  PayableApprovers,
  PayableCounterpartySearch,
  PayableDetailsV1,
  PayableFees,
  PayableFormV1,
  PayableFormHeader,
  PayableLineItems,
  PayableMetadata,
  PayableOverview,
  PayablePaymentDestination,
  PayablePaymentSource,
  PaymentDestinationProcessingTime
} from '@mercoa/react'
import { Callout } from 'nextra/components'
import { useEffect } from 'react'
import { ComponentContainer } from '../../../../../components/helpers'
import { inv_new_ready, inv_scheduled, payerEntity, vendorEntities } from '../../../../../mockData'

# Payable Details

The `<PayableDetailsV1>` part lets users create and manage payable invoices.

## Customization Options

| Themeable | Variations | Custom Part |
| :-------: | :--------: | :--------------: |
|    ✅     |     ✅     |        ✅        |

## Props

| Name                  | Type                                                                                 | Required | Description                                                                                                                                           |
| :---------------------| :------------------------------------------------------------------------------------| :--------| :-----------------------------------------------------------------------------------------------------------------------------------------------------|
| invoiceID             | `string`                                                                             |          | The ID of the invoice to edit. Leave blank if creating a new invoice                                                                                  |
| onUpdate              | `(invoice: InvoiceResponse \| undefined) => void`                                    |          | This callback triggers when the invoice is created, updated, or deleted.                                                                          |
| heightOffset          | `number`                                                                             |          | This part uses the screen size to set its height. If you have other elements on the screen, increase the height offset to reduce the size of this section. |
| documentPosition      | `'right' \| 'left' \| 'none'`                                                        |          | Control where to place the invoice document (or hide it). Default is `left`.                                                                          |
| invoicePreSubmit      | `(invoice: Mercoa.InvoiceCreationRequest) => Promise<Mercoa.InvoiceCreationRequest>` |          | This function runs after frontend validations are complete, and before the API calls to create/update the invoice.                        |
| counterpartyPreSubmit | `(counterparty: Mercoa.EntityRequest \| Mercoa.EntityUpdateRequest \| undefined, counterPartyId: string \| undefined) => Promise<Mercoa.EntityRequest \| Mercoa.EntityUpdateRequest \| undefined>` |          | Call this function before submitting an entity to Mercoa. Useful for adding custom fields to the entity or preventing submission |
| children              | `(methods: PayableDetailsChildrenProps) => JSX.Element[]`                            |          | See [customization](#customization) for details on how to use the children prop.                                                                      |

```typescript
type PayableDetailsV1ChildrenProps = {
  invoice?: Mercoa.InvoiceResponse
  ocrResponse?: Mercoa.OcrResponse
  uploadedDocument?: string
  onUpdate: (invoice: Mercoa.InvoiceResponse | undefined) => void
  setUploadedDocument: (e?: string) => void
  height: number
  refreshInvoice: (invoiceId: Mercoa.InvoiceId) => void
  invoicePreSubmit?: (invoice: Mercoa.InvoiceCreationRequest) => Promise<Mercoa.InvoiceCreationRequest>
  onOcrComplete: (ocrResponse?: Mercoa.OcrResponse) => void
};
```

## Examples

### Edit Existing Invoice

<ComponentContainer>
  <PayableDetailsV1 invoiceId={'inv_new_ready'} />
  ```jsx
<PayableDetailsV1
  invoiceId={'inv_XXXXX-XXXX-XXXXXX'}
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>

### Create New Invoice

<ComponentContainer>
  <PayableDetailsV1 />
  ```jsx
<PayableDetailsV1 
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>

### Document Position

<ComponentContainer>
  <PayableDetailsV1 invoiceId={'inv_new_ready'} documentPosition="right" />
  ```jsx
<PayableDetailsV1
  documentPosition="right"
  invoiceId={'inv_XXXXX-XXXX-XXXXXX'}   
  onUpdate={(invoice) => {
    if (!invoice) {
      router.push(`/dashboard/payers/${entityId}`)
      return
    }
    router.push(`/dashboard/payers/${entityId}/invoices/${invoice.id}`)
  }}
/>
  ```
</ComponentContainer>


## Customization

The `PayableDetails` consists of the [`<PayableFormV1>`](./Form) and [`<PayableDocumentV1>`](./Document) components. See those pages for how to customize them.

The default children is the following:

```tsx
<PayableDetailsV1>
 {(props) => [
     <PayableDocumentV1 {...props} key={1} />,
     <PayableFormV1 {...props} key={2} />
  ]}
</PayableDetailsV1>
```

---

## Approver Selection Customization

The selection of invoice approvers within the Payable Details flow uses the `ApproversSelectionV1` part. As of **@mercoa/react v0.1.11-rc1**, you can customize the reset selection UI behavior.

### `ApproversSelectionV1` Props

| Name         | Type                                                                                     | Required | Description                                                                                                                                               |
| ------------ | ----------------------------------------------------------------------------------------| :------: | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| allowAnyApprover | `boolean`                                                                           |    -     | Allow selecting any approver. Default: `true`                                                                                                             |
| label        | `string`                                                                                |    -     | Label for the part.                                                                                                                                       |
| renderCustom | `{ resetSelection?: (resetSelection: () => void) => React.ReactNode }`                   |    -     | Optional object for customizing internal UI. If `resetSelection` is available, it renders the reset UI instead of the default.                   |

#### `renderCustom.resetSelection`

- **Type:** `(resetSelection: () => void) => React.ReactNode`
- **Purpose:** Renders a custom UI for resetting the selection of approvers.
- **Behavior:**  
  - If provided, the default "Reset Selection" option is *not* shown.
  - Your function receives a `resetSelection` callback as an argument. Call this function to reset all selected approvers.

**If you don't give `renderCustom.resetSelection`, the default "Reset Selection" UI appears.**

### Example: Custom Reset Selection

```jsx
import { ApproversSelectionV1 } from '@mercoa/react'

<ApproversSelectionV1
  allowAnyApprover={true}
  label="Select Approvers"
  renderCustom={{
    resetSelection: (resetSelection) => (
      <button
        type="button"
        style={{ marginTop: 8, color: '#d32f2f', background: 'none', border: 'none', cursor: 'pointer' }}
        onClick={resetSelection}
      >
        Clear All Approvers
      </button>
    ),
  }}
/>
```

In this example, the default "Reset Selection" link replaces a custom-styled button. Clicking the button resets all approvers using the provided `resetSelection` function.